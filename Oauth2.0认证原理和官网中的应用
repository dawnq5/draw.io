<mxfile host="app.diagrams.net" modified="2022-05-28T05:20:39.605Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36" etag="wtPy2KYn2g5wnA2SzmEx" version="18.0.3" type="github" pages="2">
  <diagram id="swH5sri_FAdhZOplbbes" name="原理">
    <mxGraphModel dx="1038" dy="547" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="otZpcaZ7QC8Pptfllp5s-3" value="&lt;div&gt;OAuth2.0中规定了多种授权模式，其中授权码模式是最安全的模式，使用最广泛，也是主流。基本流程是先通过前端渠道客户获取授权码，&lt;/div&gt;&lt;div&gt;然后通过后端渠道，客户使用Authrization Code去交换Access Token和可选的Refresh Token，这种模式是最安全的模式，因为令牌不会通过user-agent去传递。&lt;span style=&quot;background-color: initial;&quot;&gt;授权码模式的优点是比较安全，他可以有token过期时间，而且上面的第四和第五步都是在服务器之间的访问，很难被截获，用户信息也存在服务端，这样就保证了他的安全性。他的缺点是需要进行多次请求才能访问到资源。&lt;/span&gt;&lt;/div&gt;&lt;div&gt;授权码模式假定资源拥有者和客户不在一台设备上，他拥有高安全性的保障，目前市面上主流的第三方认证都是采用这种模式。&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;dashed=1;dashPattern=1 4;fillColor=none;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="20" y="50" width="770" height="90" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-4" target="otZpcaZ7QC8Pptfllp5s-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-4" target="otZpcaZ7QC8Pptfllp5s-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-4" value="授权服务器" style="whiteSpace=wrap;html=1;aspect=fixed;fillColor=#647687;strokeColor=#314354;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="590" y="895" width="120" height="120" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-14" target="otZpcaZ7QC8Pptfllp5s-16">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="470" y="710" />
              <mxPoint x="470" y="775" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-14" target="otZpcaZ7QC8Pptfllp5s-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-14" target="otZpcaZ7QC8Pptfllp5s-42">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-14" target="otZpcaZ7QC8Pptfllp5s-16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;fontSize=18;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-14" target="otZpcaZ7QC8Pptfllp5s-4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="780" y="740" />
              <mxPoint x="780" y="985" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-14" value="Web网站服务器" style="whiteSpace=wrap;html=1;aspect=fixed;fillColor=#6d8764;strokeColor=#3A5431;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="590" y="650" width="120" height="120" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-15" target="otZpcaZ7QC8Pptfllp5s-16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-15" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=default;gradientColor=none;" vertex="1" parent="1">
          <mxGeometry x="40" y="730" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-16" target="otZpcaZ7QC8Pptfllp5s-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-16" target="otZpcaZ7QC8Pptfllp5s-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-16" value="浏览器" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e3c800;fontColor=#000000;strokeColor=#B09500;" vertex="1" parent="1">
          <mxGeometry x="210" y="730" width="100" height="60" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-18" value="1 login.winxuan.com&lt;br&gt;2 点击微信登录" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="90" y="720" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-26" value="3&amp;nbsp;login.winxuan.com/auth/weixin" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="350" y="660" width="190" height="20" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-32" value="4 重定向到open.weixin.qq.com/connect/qrconnect &lt;br&gt;微信扫码登录界面" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="315" y="790" width="280" height="30" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-34" value="5 用户扫码确认登录" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="315" y="960" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-36" value="6 微信回调应用程序接口 返回code码 &lt;br&gt;login.winxuan.com/auth/successWeixin" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="435" y="835" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-39" value="7 服务器内部根据获取的code和申请的appid/secret 获取accessToken&lt;br&gt;api.weixin.qq.com/sns/oauth2/access_token" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="560" y="805" width="380" height="30" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-41" value="8 返回accessToken/refreshToken/openid/uid等信息" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="680" y="770" width="290" height="20" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-42" value="用户中心" style="whiteSpace=wrap;html=1;aspect=fixed;fillColor=#6d8764;strokeColor=#3A5431;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="920" y="650" width="120" height="120" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-44" value="10 调用用户查询接口登录" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="730" y="690" width="150" height="20" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-46" value="11 登录成功，跳转" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="385" y="600" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-47" value="文轩网微信登录为例，登录流程" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="550" width="270" height="30" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-48" value="OAuth2.0登录流程" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="170" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-51" value="9 根据accessToken获取&lt;b&gt;unionId&lt;/b&gt;、用户名、性别等用户信息&lt;br&gt;api.weixin.qq.com/sns/userinfo" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="720" y="930" width="330" height="30" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-52" value="&lt;div style=&quot;font-size: 15px;&quot;&gt;1、得到授权码 auth code&lt;/div&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;2、获取access token&lt;/div&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;3、通过access token获取openId&lt;/div&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;4、通过access token及OpenId调用API获取用户授权信息&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;fillColor=none;gradientColor=none;align=left;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="40" y="300" width="390" height="90" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-55" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=15;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-53" target="otZpcaZ7QC8Pptfllp5s-54">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-53" value="1 跳转至用户授权地址" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;fillColor=none;gradientColor=none;" vertex="1" parent="1">
          <mxGeometry x="490" y="200" width="155" height="50" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-70" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=13;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-54" target="otZpcaZ7QC8Pptfllp5s-59">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-54" value="生成auth code" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;fillColor=none;gradientColor=none;" vertex="1" parent="1">
          <mxGeometry x="795" y="200" width="155" height="50" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-56" value="request code url" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=15;" vertex="1" parent="1">
          <mxGeometry x="655" y="200" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-57" value="提示登录、给与授权" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="655" y="230" width="130" height="20" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-71" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=13;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-58" target="otZpcaZ7QC8Pptfllp5s-64">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-58" value="生成accessToken" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;fillColor=none;gradientColor=none;" vertex="1" parent="1">
          <mxGeometry x="795" y="330" width="155" height="50" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=13;" edge="1" parent="1" source="otZpcaZ7QC8Pptfllp5s-59" target="otZpcaZ7QC8Pptfllp5s-58">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-59" value="2 请求accessToken" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;fillColor=none;gradientColor=none;" vertex="1" parent="1">
          <mxGeometry x="490" y="330" width="155" height="50" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-62" value="生成accessToken" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;fillColor=none;gradientColor=none;" vertex="1" parent="1">
          <mxGeometry x="795" y="430" width="155" height="50" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-63" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=13;" edge="1" source="otZpcaZ7QC8Pptfllp5s-64" target="otZpcaZ7QC8Pptfllp5s-62" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-64" value="3 请求openId" style="rounded=0;whiteSpace=wrap;html=1;fontSize=15;fillColor=none;gradientColor=none;" vertex="1" parent="1">
          <mxGeometry x="490" y="430" width="155" height="50" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-68" value="request accessToken url" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="640" y="335" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="otZpcaZ7QC8Pptfllp5s-69" value="request openId url" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="655" y="430" width="120" height="20" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="GrMy3OksuFpIKsW0K58D" name="文轩网第三方登录代码设计">
    <mxGraphModel dx="1038" dy="547" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
